(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3643dcb9"],{"9ac7":function(t,e,i){"use strict";i("de12")},"9dac":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{},[i("el-upload",{attrs:{action:"#","list-type":"picture-card","auto-upload":!0,multiple:!0,limit:t.limit,action:t.action,"before-upload":t.beforeUpload,"on-success":t.handleAvatarSuccess,name:"img","file-list":t.file_list,"on-remove":t.handleRemove}},[i("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})]),i("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)},l=[],n=i("a49b"),o={data:function(){return{action:this.$getimg+"admin/common/upload_img",dialogImageUrl:"",dialogVisible:!1,disabled:!1,getimg:this.$getimg,imageUrl:"",img_list:[],file_list:[]}},props:["limit"],methods:{get_img_list:function(){this.$emit("img_list",this.img_list)},handleAvatarSuccess:function(t){console.log(t),console.log(this.file_list);var e={id:t.data.id,url:t.data.url};this.img_list.push(e),this.$emit("img_list",this.img_list)},beforeUpload:function(){if(n["b"])return this.$message({message:"演示版",type:"error",duration:5e3}),!1},handleRemove:function(t){console.log(t);var e=t.response.data.id;for(var i in this.img_list){var a=this.img_list[i];1*e==1*a.id&&(this.img_list.splice(i,1),this.$emit("img_list",this.img_list))}},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleDownload:function(t){console.log(t)}}},s=o,r=i("cba8"),c=Object(r["a"])(s,a,l,!1,null,null,null);e["a"]=c.exports},b365:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"root"},[i("el-tabs",{attrs:{type:"border-card",value:t.active},on:{"tab-click":t.tab_change}},[i("el-tab-pane",{attrs:{label:"车辆管理",name:"1"}},[i("el-row",{staticStyle:{"text-align":"left","margin-bottom":"15px"}},[i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.add_car}},[t._v("新增车辆")])],1),i("el-col",{attrs:{span:5}},[i("el-date-picker",{staticStyle:{width:"70%"},attrs:{size:"mini",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.get_date_range},model:{value:t.date_range,callback:function(e){t.date_range=e},expression:"date_range"}})],1),i("el-col",{attrs:{span:4}},[i("el-input",{staticStyle:{width:"45%"},attrs:{size:"mini",placeholder:"请输入搜索内容"},model:{value:t.search_key,callback:function(e){t.search_key=e},expression:"search_key"}}),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.search}},[t._v("搜索")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.reset}},[t._v("重置")])],1)],1),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[i("el-table-column",{attrs:{align:"center",type:"index",label:"序号"}}),i("el-table-column",{attrs:{align:"center",prop:"create_time",type:"",label:"添加时间",width:"120"}}),i("el-table-column",{attrs:{align:"center",prop:"operators.name",label:"添加人",width:"120"}}),i("el-table-column",{attrs:{align:"center",prop:"car_num",label:"车牌号",width:"100"}}),i("el-table-column",{attrs:{align:"center",prop:"drive_name",label:"司机姓名"}}),i("el-table-column",{attrs:{align:"center",prop:"mobile",label:"司机联系电话",width:"150"}}),i("el-table-column",{attrs:{align:"center",prop:"fleet",label:"所属车队",width:"100"}}),i("el-table-column",{attrs:{align:"center",prop:"id_card",label:"身份证号",width:"180"}}),i("el-table-column",{attrs:{align:"center",prop:"oil_card",label:"油卡号",width:"180"}}),i("el-table-column",{attrs:{align:"center",prop:"bank_name",label:"开户银行",width:"120"}}),i("el-table-column",{attrs:{align:"center",prop:"bank_user",label:"户名"}}),i("el-table-column",{attrs:{align:"center",prop:"bank_num",label:"银行账户",width:"180"}}),i("el-table-column",{attrs:{align:"center",label:"证件照",width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.card_img,(function(a,l){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击预览大图",placement:"top-end"}},[i("el-image",{key:l,staticStyle:{width:"40px",height:"40px",margin:"5px"},attrs:{src:t.get_img+a.url,"preview-src-list":e.row.preview_list}})],1)]}))]}}])}),i("el-table-column",{attrs:{align:"center",prop:"equip_num",label:"GPS设备",width:"150"}}),i("el-table-column",{attrs:{align:"center",label:"备注"}}),i("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.equip_num?i("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(i){return t.cancel_bind(e.row.id)}}},[t._v("解绑设备")]):i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return t.bind(e.row.id)}}},[t._v("绑定设备")]),i("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(i){return t.edit_car(e.row)}}},[t._v("修改")]),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){return t.del(e.row.id)}}},[t._v("删除")])]}}])})],1),i("el-pagination",{staticStyle:{"padding-top":"60px"},attrs:{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.size},on:{"current-change":t.jump_page}})],1),i("el-tab-pane",{attrs:{label:"设备管理",name:"3"}},[i("el-row",{staticStyle:{"text-align":"left","margin-bottom":"15px"}},[i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.eq_dialogVisible=!0}}},[t._v("新增设备")])],1),i("el-col",{attrs:{span:5}},[i("el-date-picker",{staticStyle:{width:"70%"},attrs:{size:"mini",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.get_date_range},model:{value:t.date_range,callback:function(e){t.date_range=e},expression:"date_range"}})],1),i("el-col",{attrs:{span:4}},[i("el-input",{staticStyle:{width:"45%"},attrs:{size:"mini",placeholder:"请输入搜索内容"},model:{value:t.search_key,callback:function(e){t.search_key=e},expression:"search_key"}}),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.search}},[t._v("搜索")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.reset}},[t._v("重置")])],1),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){return t.to_excel("eq")}}},[t._v("数据导出")])],1)],1),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.eq_list,border:""}},[i("el-table-column",{attrs:{type:"index",label:"序号"}}),i("el-table-column",{attrs:{prop:"create_time",label:"添加时间"}}),i("el-table-column",{attrs:{prop:"num",label:"设备编号"}}),i("el-table-column",{attrs:{prop:"operators.name",label:"操作员"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(i){return t.edit_eq(e.row)}}},[t._v("修改")]),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){return t.del_eq(e.row.id)}}},[t._v("删除")])]}}])})],1),i("el-pagination",{staticStyle:{"padding-top":"60px"},attrs:{background:"",layout:"prev, pager, next",total:t.total_eq,"page-size":t.size},on:{"current-change":t.jump_page}})],1)],1),i("el-dialog",{attrs:{title:"绑定设备",visible:t.eq_bind,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.eq_bind=e}}},[i("el-form",{ref:"form",attrs:{model:t.bind_form,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"设备编号:"}},[i("el-select",{staticStyle:{width:"85%"},attrs:{filterable:"",size:"mini",placeholder:"请输入搜索内容"},model:{value:t.bind_form.id,callback:function(e){t.$set(t.bind_form,"id",e)},expression:"bind_form.id"}},t._l(t.eq_list,(function(e){return e.car?t._e():i("el-option",{attrs:{label:e.num,value:e.id}})})),1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.eq_bind=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.sub_bind}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:t.is_edit_eq?"修改设备":"新增设备",visible:t.eq_dialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.eq_dialogVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.eq_form,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"设备编号:"}},[i("el-input",{model:{value:t.eq_form.num,callback:function(e){t.$set(t.eq_form,"num",e)},expression:"eq_form.num"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.eq_dialogVisible=!1}}},[t._v("取 消")]),t.is_edit_eq?i("el-button",{attrs:{type:"primary"},on:{click:t.sub_edit_eq}},[t._v("确 定")]):i("el-button",{attrs:{type:"primary"},on:{click:t.sub_add_eq}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"add"==t.dialog_type?"新增车辆":"修改",visible:t.add_dialog,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.add_dialog=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"*车牌号:"}},[i("el-input",{model:{value:t.form.car_num,callback:function(e){t.$set(t.form,"car_num",e)},expression:"form.car_num"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"*司机:"}},[i("el-input",{model:{value:t.form.drive_name,callback:function(e){t.$set(t.form,"drive_name",e)},expression:"form.drive_name"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"*联系电话:"}},[i("el-input",{model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"所属车队:"}},[i("el-input",{model:{value:t.form.fleet,callback:function(e){t.$set(t.form,"fleet",e)},expression:"form.fleet"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"身份证号:"}},[i("el-input",{model:{value:t.form.id_card,callback:function(e){t.$set(t.form,"id_card",e)},expression:"form.id_card"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"油卡卡号:"}},[i("el-input",{model:{value:t.form.oil_card,callback:function(e){t.$set(t.form,"oil_card",e)},expression:"form.oil_card"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"开户行:"}},[i("el-input",{model:{value:t.form.bank_name,callback:function(e){t.$set(t.form,"bank_name",e)},expression:"form.bank_name"}})],1)],1),i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"户名:"}},[i("el-input",{model:{value:t.form.bank_user,callback:function(e){t.$set(t.form,"bank_user",e)},expression:"form.bank_user"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"银行卡号:"}},[i("el-input",{model:{value:t.form.bank_num,callback:function(e){t.$set(t.form,"bank_num",e)},expression:"form.bank_num"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"车型:"}},[i("el-input",{model:{value:t.form.model,callback:function(e){t.$set(t.form,"model",e)},expression:"form.model"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"栏高:"}},[i("el-input",{model:{value:t.form.height,callback:function(e){t.$set(t.form,"height",e)},expression:"form.height"}})],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:12}})],1),i("el-form-item",{staticStyle:{"text-align":"left"},attrs:{"label-width":"130px",label:"证件照(包括身份证正反面,营运证,驾驶证,行驶证照片):"}},[t._l(t.form.card_img,(function(e,a){return[i("el-image",{staticStyle:{width:"148px",height:"148px"},attrs:{src:t.get_img+e.url}}),i("i",{staticClass:"el-icon-circle-close",staticStyle:{"margin-top":"-50px"},attrs:{slot:"default"},on:{click:function(e){return t.del_img(t.form.card_img,a)}},slot:"default"})]})),"add"==t.dialog_type||t.form.card_img&&t.form.card_img.length<5?i("Upload",{ref:"up_img",attrs:{limit:5},on:{img_list:t.get_img_list}}):t._e()],2)],1),t._v("\n\t\t注：带*号选项为必填，否则无法添加\n\t\t"),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.add_dialog=!1}}},[t._v("取 消")]),"add"==t.dialog_type?i("el-button",{attrs:{type:"primary"},on:{click:t.sub_add}},[t._v("确 定")]):i("el-button",{attrs:{type:"primary"},on:{click:t.sub_edit}},[t._v("提交修改")])],1)],1)],1)},l=[],n=(i("a450"),i("9dac")),o=i("5b75"),s={components:{Upload:n["a"],MapDrag:o["a"]},data:function(){return{export_date:[],all_eq:[],total:0,total_eq:0,size:10,active:"1",search_key:"",is_edit_eq:!1,value:"",date_range:"",eq_form:{},eq_dialogVisible:!1,edit_list:[],get_img:this.$getimg,is_relook:!1,car_position:[],group_dialog_title:"新增车队",is_detail:!1,dialog_type:"add",add_dialog:!1,group_dialog:!1,form:{},group_form:{},car_type:{1:"自有车辆",2:"车队车辆",3:"挂靠车辆",4:"社会车辆"},group:{1:"兴义车队",2:"安龙车队",3:"贵阳车队",4:"广西车队",5:"云南车队"},tableData:[],img_list:[],eq_list:[],bind_form:[],eq_bind:!1,all_car1:[],map_car:[1,2]}},watch:{group_dialog:function(t,e){t||(this.is_detail=!1,this.group_form={})},is_relook:function(t,e){console.log(this.is_relook)},add_dialog:function(t,e){t||(this.form={})},eq_dialogVisible:function(t,e){t||(this.eq_form={},this.is_edit_eq=!1)}},mounted:function(){this.get_map_car(),this.get_all_car(),this.get_all_eq()},methods:{to_excel:function(t){var e=localStorage.getItem("token"),i=this.export_date[0],a=this.export_date[1],l="";l="car"==t?this.get_img+"excel/export_car?token="+e:this.get_img+"excel/export_equip?token="+e,i&&a&&(l=l+"&start_time="+i+"&end_time="+a),window.open(l)},get_map_car:function(){var t=this;this.http.get("admin/car/get_car_position").then((function(e){t.map_car=e.data}))},jump_page:function(t){var e=this,i=(t-1)*e.size,a=t*e.size;"1"==this.active&&(this.tableData=this.all_car1.slice(i,a)),"3"==this.active&&(this.eq_list=this.all_eq.slice(i,a))},get_select_car:function(t){for(var e in console.log(t),this.map_car){var i=this.map_car[e];i.id==t&&(console.log(i),this.get_position(i.position))}},search:function(){"1"==this.active&&(this.tableData=this.search_func(this.all_car1)),"3"==this.active&&(this.eq_list=this.search_func(this.eq_list))},search_func:function(t){var e=[];for(var i in t){var a=t[i];a=JSON.stringify(a),a.indexOf(this.search_key)>0&&(a=JSON.parse(a),e.push(a))}return console.log("搜索结果",e),e},reset:function(){this.date_range="",this.search_key="","1"==this.active?this.get_all_car():this.get_all_eq()},get_date_range:function(t){var e=this;console.log(t),this.export_date=t,"1"==this.active?this.http.get("admin/car/get_all_car?start="+t[0]+"&end="+t[1]).then((function(t){for(var i in t.data){var a=t.data[i];for(var l in a["preview_list"]=[],a.card_img){var n=a.card_img[l];a["preview_list"].push(e.get_img+n.url)}}e.tableData=t.data})):this.http.get("admin/equip/get_type?start="+t[0]+"&end="+t[1]).then((function(t){e.eq_list=t.data}))},cancel_bind:function(t){var e=this;this.$confirm("确定取消设备绑定？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.http.Del("admin/car/cancel_equip?id="+t).then((function(t){e.$message({message:"解绑成功",type:"success"}),e.get_all_car()}))}))},bind:function(t){this.eq_bind=!0,this.bind_form.cid=t},sub_bind:function(){var t=this;this.http.put_show("admin/equip/bind_car?id="+this.bind_form.id+"&cid="+this.bind_form.cid).then((function(e){t.$message({message:"绑定成功",type:"success"}),t.eq_bind=!1,t.get_all_car()}))},edit_eq:function(t){this.eq_form=t,this.is_edit_eq=!0,this.eq_dialogVisible=!0},sub_edit_eq:function(){var t=this;this.http.put_show("admin/equip/up_equip?id="+this.eq_form.id+"&num="+this.eq_form.num).then((function(e){t.$message({message:"修改成功",type:"success"}),t.get_all_eq(),t.eq_dialogVisible=!1}))},del_eq:function(t){var e=this;this.$confirm("确定删除该车辆？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.http.Del("admin/equip/del_equip?id="+t).then((function(t){e.$message({message:"删除成功",type:"success"}),e.get_all_eq()}))}))},sub_add_eq:function(){var t=this;this.http.post_show("admin/equip/add_equip",this.eq_form).then((function(e){t.$message({message:"添加成功",type:"success"}),t.eq_dialogVisible=!1,t.get_all_eq()}))},get_all_eq:function(){var t=this;this.http.get("admin/equip/get_type").then((function(e){t.total_eq=e.data.length,t.all_eq=e.data,t.eq_list=e.data.slice(0,t.size)}))},sub_edit:function(){var t=this;this.dialog_type="add",this.add_dialog=!1,console.log(this.form),this.http.post_show("admin/car/update_car",this.form).then((function(e){t.$message({message:"修改成功",type:"success"}),t.dialog_type="add",t.add_dialog=!1,t.get_all_car()}))},del_img:function(t,e){console.log(t),t.splice(e,1)},get_all_car:function(){var t=this;this.http.get("admin/car/get_all_car").then((function(e){for(var i in e.data){var a=e.data[i];for(var l in a["preview_list"]=[],a.card_img){var n=a.card_img[l];a["preview_list"].push(t.get_img+n.url)}}t.total=e.data.length,t.all_car1=e.data,t.tableData=e.data.slice(0,t.size),console.log(t.tableData)}))},get_img_list:function(t){if(console.log("上传的图片",t),this.img_list=[],this.img_list.length>0)for(var e in t)this.img_list.push(t[e]);else this.img_list=t},sub_add:function(){var t=this;this.form.card_img=this.img_list,this.form.car_num?this.form.drive_name?this.form.mobile?this.http.post_show("admin/car/add_car",this.form).then((function(e){t.$message({message:"添加成功",type:"success"}),t.add_dialog=!1,t.get_all_car()})):this.$message({message:"未填写联系电话",type:"warning"}):this.$message({message:"未填写司机",type:"warning"}):this.$message({message:"未填写车牌号",type:"warning"})},relook:function(){this.is_relook=!0,this.$refs.map.relook()},all_car:function(){this.$refs.map.all_car()},get_position:function(t){console.log(t),this.$refs.map.set_position(t)},filterHandler:function(t,e,i){var a=i["property"];return e[a]===t},tab_change:function(t){this.active=t.name},jump_to_map:function(){this.$router.push({path:"/map"})},del:function(t){var e=this;this.$confirm("确定删除该车辆？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.http.Del("admin/car/del_car?id="+t).then((function(t){e.$message({type:"success",message:"删除成功!"}),e.get_all_car()}))}))},edit_car:function(t){console.log(t),this.dialog_type="edit",this.add_dialog=!0,this.form=t,this.img_list=t.card_img},add_car:function(){this.add_dialog=!0},handleClose:function(){this.eq_bind=!1,this.group_dialog=!1,this.add_dialog=!1,this.group_dialog_title="新增车队",this.form={}}}},r=s,c=(i("9ac7"),i("cba8")),d=Object(c["a"])(r,a,l,!1,null,null,null);e["default"]=d.exports},de12:function(t,e,i){}}]);